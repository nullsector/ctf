# PAN LabyREnth 2017 - Docs #4

Hint: A zip, a js, a binary, oh my! I heard you like layerz dawg, so
I put more layers inside yo' layers.

## Write-up
We're given a file called Secret Beach Party Invite.msg
Secret Beach Party Invite.msg contains a password protected 7z archive.

![here](Secret1.JPG)

Writen in a white color: http://www.reversing.sg/B3@chP@r7y/

In the source of page:

:@######################################################################################################################      
     #+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++      
     #+#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#++      
     #++'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''#+      
     #++'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++#'#+      
     #+++`                                                                                                               #'#+      
     #+++`                                                                                                               #'#+      
     #+++`                 00000000  57 65 5F 68 61 64 5F 6a 6f 79 2c 5F 77 65 5F 68  |R3JlYXQgc3RhcnQg|                 #'#+      
     #+++`                 00000010  61 64 5F 66 75 6e 2c 5F 77 65 5F 68 61 64 5F 73  |aW4gZmluZGluZyB0|                 #'#+      
     #+++`                 00000020  65 61 73 6f 6e 73 5F 69 6e 5F 74 68 65 5F 73 75  |aGlzIGNsdWUuICAN|                 #'#+      
     #+++`                 00000030  6e 2E 2E 42 75 74 5F 74 68 65 5F 77 69 6e 65 5F  |CldlIGhvcGUgdGhh|                 #'#+      
     #+++`                 00000040  61 6e 64 5F 74 68 65 5F 73 6f 6e 67 5F 6c 69 6b  |dCB5b3UgbGlrZSBo|                 #'#+      
     #+++`                 00000050  65 5F 74 68 65 5F 73 65 61 73 6f 6e 73 5F 68 61  |dW50aW5nLiANCkFz|                 #'#+      
     #+++`                 00000060  76 65 5F 61 6c 6c 5F 67 6f 6e 65 2E 2E 57 65 5F  |IHRoZXJlIGFyZSBz|                 #'#+      
     #+++`                 00000070  68 61 64 5F 6a 6f 79 2c 5F 77 65 5F 68 61 64 5F  |ZXZlcmFsIHRoaW5n|                 #'#+      
     #+++`                 00000080  66 75 6e 2c 5F 77 65 5F 68 61 64 5F 73 65 61 73  |cyBmb3IgeW91IHRv|                 #+++#     
     #+++`                 00000090  6f 6e 73 5F 69 6e 5F 74 68 65 5F 73 75 6e 2E 2E  |IGh1bnQgZm9yLg0K|                 #,...#    
     #+++`                 000000a0  42 75 74 5F 74 68 65 5F 77 69 6e 65 5F 61 6e 64  |DQpUaGUgaGludCB0|                 #.....#   
     #+++`                 000000b0  5F 74 68 65 5F 73 6f 6e 67 5F 6c 69 6b 65 5F 74  |byBsb2dpbiBpczog|                 #.....,;  
     ##+#,                 000000c0  53 68 69 74 69 73 72 65 61 6c 6c 79 62 72 6f 6b  |DQpvbWd3dGZub2Ji|                `+......#  
    ':...;`;#+.            000000d0  63 51 3d 3d                                      |cQ==|                           +::@,....'  
   #,....:+...:,                                                                                                      :....;;...:  
  ;,....':.....+                                                                                                      #.....,+..,  
  '....#.......#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::+.......+.;  
 #....:,......;+''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''+;......::+  
 ;....+......;#++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++@.......##  
 ,....;.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++......;'  
 :....;.....#######+++++++++++++++++++++++++++++++++++++++++++###+++++++++++++++++++++++++++++++++++++++++++++#######+++#......:   
 #....+....,,......#.........................................,,..+............................................#.....+...#......+   
 ',...:,....;.....'                                           ...+                                            +.....,+ ;,......+   
  #....#,,,:+,....+                                          '...#                                            .:....:'@@++;;,.+    
   #++',,.....,:'#',                                         '...#                                             #,+',.........;+'   
   +...............,+;                                       +...+                                             +,...............;' 
   +.................#                                      '#+++#+                                            +.................+ 
   +.................+                                     #.``````;;                                          '.................+ 
   +................,,                                    '`````````#                                           ,................+ 
   +................+                                    ;#;+++++++:#;:                                         ;................' 
   '................+                                 '#:.............,'#'                                      #...............,  
    ,..............'                                #'....................+'                                    #...............'  
    ;..............+                               #........................#                                   '...............#  
    +.............+                               '..........................'                                   :..............+  
    #............,'                              +............................#                                  #.............,   
    ':;++###+#';.#                              #..............................#                                 ',............+   
    ':,,,,,,,,,,'.                             ;:..............................;                                  ##+';:''+#+;.+   
    ',,,,,,,,,,,:                              #................................+                                 +,,,,,,,,,,,;.   
    ',,,,,,,,,,,:                              ;................................#                                 ',,,,,,,,,,,:    
    ',,,,,,,,,,,:                             '.................................;                                 ',,,,,,,,,,,:    
    ',,,,,,,,,,,:                             #.................................:                                  ,,,,,,,,,,,:    
    ',,,,,,,,,,,:                             #.................................:                                  ,,,,,,,,,,,'    
    ',,,,,,,,,,,:                             ';;++'':::::::.,,,,,,,,,,,,,,,,,.:;'#':                              ,,,,,,,,,,,+    
    ',,,,,,,,,,,:                          '+:.````````````....................`````,+'                            ,,,,,,,,,,,+    
    ',,,,,,,,,,,:                         #``.;+####@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##:``.#                           ,,,,,,,,,,,#    
    +,,,,,,,,,,,:                        #`,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'`.#                          ,,,,,,,,,,,#    
    +,,,,,,,,,,,:                       +`.@@@@@@@#'.```.'#@@@@@@@@@@@@#',,.,'@@@@@@@@+`:                          ,,,,,,,,,,,#    
    +,,,:;';:,,,:                       '`#@@@@@#```````````@@@@@@@@@'`````````,@@@@@@@``#                         ,,,,,,,,,,,+    
    +:#;,,,,,:++:                      '.,@@@@@;`````````````#@@@@@@.````````````#@@@@@;`'                         #+:;'+#',,,+    
    #;,,,,,,,,,,+                      #`+@@@@+```````````````@@@@@,``````````````@@@@@#`,                         ,,,,,,,,;#:+    
    +,,,,,,,,,,,,                      ;`#@@@@,:,`````````````'@@@#```````````````'@@@@@`.                        :,,,,,,,,,,;'    
    +,,,,,,,,,,,,:                     ,`@@@@##@@`````````````,@@@'@@+````````````,@@@@#`.                        ',,,,,,,,,,,'    
    +,,,,,,,,,,,,'                     .`@@@@#:';``````````````@@@,#@;`````````````@@@@+`.                        ',,,,,,,,,,,     
    +,,,,,,,,,,,,'                     .`@@@@# ```````````````.@@@:```````````````.@@@@,`,                        +,,,,,,,,,,,     
    +,,,,,,,,,,,,'                     ;`#@@@@``````````````` ,@@@;```````````````,@@@#``;                        +,,,,,,,,,,:     
    +,,,,,,,,,,,,+                     #`,@@@@.```````````````#@@@@```````````````#@@@,``#                        #,,,,,,,,,,:     
    +,,,,,,,,,,,,+                     ,,`:@@@# `````````````.@@@@@,`````````````:@@#.``,,                        #,,,,,,,,,,'     
    +,,,,,,,,,,,,+                      #```:+@;.````````````@@@@@@@````````````,@#,````#                         +,,,,,,,,,,'     
    +,,,,,,,,,,,,#                       #`````````.,,,,,,,,.........,,,,,,,,,,,.``````#                          ',,,,,,,,,,+     
    ',,,;#+';:;'##                        #```````````````````````````````````````````+                           '+###':,,,,#     
    ',+',,,,,,,,,+                         #`````````````````````````````````````````'.                           :,,,,,:;#;,#     
    ,#,,,,,,,,,,,+                          #```````````````````````````````````````',                            ,,,,,,,,,:#+     
     ,,,,,,,,,,,,;                           #.``````````..........````````````````#                             ',,,,,,,,,,,'     
     :,,,,,,,,,,,:                            #+++++#++;,,.........,,:;+#++';;;;++'.                             +,,,,,,,,,,,'     
     ;,,,,,,,,,,,,                            +....................................                              #,,,,,,,,,,,      
     +,,,,,,,,,,,,;                           +....................................                              +,,,,,,,,,,:      
     #,,,,,,,,,,,,'                           +....................................                              ;,,,,,,,,,,'      
     #,,,,,,,,,,,,+                           +....................................                              ,,,,,,,,,,,+      
     +,,,,,,,,,,,,#                           +.......,++''::...'...,::'#+;........                             ',,,,,,,,,,,#      
     ',,,,,,,,,,,,#                           +.....;'.```,`````'```````,``.+;.....                             +,,,,,,,,,,,#      
      :,,,,,,,::,,+                           +....##`````,`````' ``````,````,#....                             #,,,,,,,,,,,+      
      ;,,;#'::,:;+#                           +...#`+`````,`````'```````,````,`#...                             +;'';:,,,,,,'      
      +;#:,,,,,,,,,                           +..;``+`````,`````'```````,````,``'..                             ;,,,,:++:,,:       
      #;,,,,,,,,,,,'                          +..+``+`````:..,:;+;;;;;;,:.`` ,``+..                            ',,,,,,,,:#:'       
      ',,,,,,,,,,,,#                          +..;.;@+;:..,``` `;      `,`.:;++;:..                            #,,,,,,,,,,'#       
      .:,,,,,,,,,,,+                          +..:``+`````,`````'```````,````,``...                            #,,,,,,,,,,,+       
       ',,,,,,,,,,,;                          +..```+`````,`````' ``````,````, ``,.                            ;,,,,,,,,,,,'       
       #,,,,,,,,,,,:                          +..```+`````,`````'```````,````,```:.                           :,,,,,,,,,,,:        
       +,,,,,,,,,,,,+                         +..,``+`````,`````'```````,````,```..                           +,,,,,,,,,,,'        
       .:,,,,,,,,,,,#                         +..:`:#+#'''+'''::+:::::::'''++':....                           #,,,,,,,,,,,#        
        ',,,,,,,,,,,+                         +..'.`+`````,`````' ``````,````,``:..                           ;,,,,,,,,,,,+        
        #,,,,,,,,,,,;                         +..+``+`````,`````' ``````,````,``;..                          ':;':,,,,,,,,'        
        ',,,,,,,,,,,,;                        +..,,`+`````,`````' ``````,````,``#..                          #:,,,;++,,,,;         
         ',,,,,:+##+;+                        +...':#`````:.````+```````,````,`:,..                          +,,,,,,,;#,,#         
         #,,,'+:,,,,,+                        +.....,,,.............,:,,:;'++++,...                          :,,,,,,,,,#:+         
         ',,#,,,,,,,,;                        +....................................                         +,,,,,,,,,,,+.         
          '#,,,,,,,,,,'                       +....................................                         #,,,,,,,,,,,'          
          #,,,,,,,,,,,#                       +:;;++++#+++++++++++++++++++#+++++;;;;                        ;,,,,,,,,,,,#          
          +,,,,,,,,,,,;                     :#,````````````````````````````````````.+'                     ',,,,,,,,,,,,'          
           ;,,,,,,,,,,,+                   #:````````````````````````````````````````.+;                   #,,,,,,,,,,,;           
           #,,,,,,,,,,,#                 ;'````````````````````````````````````````````,#                  ;,,,,,,,,,,,#           
           ',,,,,,,,,,,::               #,```````````````````````````````````````````````+:               ',,,,,,,,,,,:'           
            +,,,,,,,,,,,#              #.`````````````````````````````````````````````````,+              #++',,,,,,,,+            
            +,,,,,,,,,,,;             #````````````````````````````````````````````````````.#             ;,,,;#,,,,,,#            
            .;,,,,,,,,,,,#           #```````````````````````````````````````````````````````#           +,,,,,,+;,,,;.            
             #,,,,,,,;++++          +`````````````````````````````````````````````````````````#          +,,,,,,,;+,,#             
             ':,,,:#;,,,,,#        +```````````````````````````````````````````````````````````+        ;:,,,,,,,,:+:'             
              #,,#;,,,,,,,:'      #`````````````````````````````````````````````````````````````#       #,,,,,,,,,,:#              
              ':':,,,,,,,,,'     #```````````````````````````````````````````````````````````````###+#  ;,,,,,,,,,,:'              
               #+,,,,,,,,,,,##;:#.````````````````````````````````````````````````````````````````#...;#,,,,,,,,,,,+               
               ':,,,,,,,,,,';...:`````````````````````````````````````````````````````````````````.+....+,,,,,,,,,,'               
                #,,,,,,,,,;,...+````````...,;;;'+++676f6f2e676c2f795632744673+++++;;;;;...`````````,,...,;,,,,,,,,#                
                ':,,,,,,,,'...,;+#+;;;:,,................................................,,:;++++',`#....+,,,,,,,;,                
                 #,,,,,,,+....:....................................................................:+,....+,,,,,,#                 
                 .',,,,,,'....:......................................................................:....+,,,,,'                  
                  +,,,,,'.....'......................................................................'....,,,,,:+                  
                   #,,,,+.....'......................................................................'.....;,,,#                   
                   .',,,#.....:......................................................................;.....+,,+                    
                    ':,,+.....:....................,,,:;;;'+++++++++++';;;,,,,.......................:.....#,;,                    
                     +,,+.....:.............:+#++:,,.........................,,,,;;;++#';:,..........:.....#:+                     
                      #,#.....:............#..............................................,';........,.....##                      
                       #+.....,............#................................................;..............#                       
                        @..................'................................................:.......,......'                       
                        .;.....:...........'........................................................:.....;                        
                         #.....:...........'........................................................:.....#                        
                         .:....:...........'...............................................:........'....'                         
                          +,...;...........'...............................................;........#...:.                         
                           +:..+...........'...............................................+........#..+,                          
                            ,+.#...........'...............................................#........;+#                            
                              '#...........:...............................................#........+                              
                               +...........:...............................................'.........                              
                               +...........:...............................................;.......,                               
                               '...........:...............................................:.......;                               
                                ...........,.......................................................+                               
                                ,..................................................................#                               
                                ;.........................................................:........#             

>R3JlYXQgc3RhcnQgaW4gZmluZGluZyB0aGlzIGNsdWUuICANCldlIGhvcGUgdGhhdCB5b3UgbGlrZSBodW50aW5nLiANCkFzIHRoZXJlIGFyZSBzZXZlcmFsIHRoaW5ncyBmb3IgeW91IHRvIGh1bnQgZm9yLg0KDQpUaGUgaGludCB0byBsb2dpbiBpczogDQpvbWd3dGZub2JicQ==

Decoding the base64 string gives us this.

Great start in finding this clue.  
We hope that you like hunting. 
As there are several things for you to hunt for.

The hint to login is: 
omgwtfnobbq

At benders chest is a hexencoded string.
>676f6f2e676c2f795632744673
Which decodes to goo.gl/yV2tFs and takes us to http://www.reversing.sg/B3@chP@r7y/Part1.png
This is the first part of our flag.
![here](Part1.png)


omgwtfnobbq is the password to the archive in the msg file.
contains a pdf file

pdf contains an HWP file

HWP file drops troll.js in %appdata%

lX0vbnD variable contains function calls that reveal http://reversing.sg/pdfHWP/part1.flag.exe

part1.flag.exe in a 32 .NET GUI app

We are given some hints in from the binary.
![here](Msg1.JPG)
![here](Msg2.JPG)

usb resource in rickroll.resx contains a pcap file.
that pcap contains 5 images which one has to be xored with 0x21
![here](usb1.jpg)
![here](usb2.jpg)
![here](usb3.jpg)
![here](usb4.jpg)

The last bit of data needs to be xored with 0x21 inorder to reveal a png file
![here](Part2.png)
the png file has half of the flag

#### Flag

>PAN{N0thing_l5_S@f3_ln_Thi5_W0rld!}
